version: "3"
services:
  consul:
    image: consul:0.7.4
    ports:
      - 8500:8500
    environment:
      - "CONSUL_BIND_INTERFACE=eth0"
      - "CONSUL_BIND_INTERFACEXXXXX=eth0"
      - "CONSUL_LOCAL_CONFIG={\"skip_leave_on_interrupt\": true}"
    command: agent   -server -ui -client=0.0.0.0 -bootstrap-expect=${SHATHEL_ENV_QUORUM} -retry-join=tasks.consul
    deploy:
      mode: global
      update_config:
        delay: 20s
  consul-client:
      image: consul:0.7.4
      environment:
        - 'CONSUL_BIND_INTERFACE=eth0'
        - 'CONSUL_LOCAL_CONFIG={"leave_on_terminate": true}'
      command: agent -retry-join=tasks.consul -rejoin
      deploy:
        mode: replicated
        replicas: 1

